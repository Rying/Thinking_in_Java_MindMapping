# Webpack
核心的数据结构：Dependency、Module、Chunk


## 流程

lib/webpack

webpack方法
- createCompiler
- 执行compiler，compiler.run

### createCompiler方法
- 组装options
- 将配置的plugin应用于compiler
- 触发environment hook
- 触发afterEnvironment hook
- 调用WebpackOptionsApply.process方法，根据配置应用一些内置的plugin
- 触发initialize hook

### WebpackOptionsApply.process方法
- 基本配置
- 根据基本配置，将内置的一些plugin应用于compiler
    - 如果配置了externals，运用ExternalsPlugin
    - 如果配置了externalsPresets
        - node，运用NodeTargetPlugin
        - electron*，ElectronTargetPlugin
        - nwjs，ExternalsPlugin
        - ChunkPrefetchPreloadPlugin
        - 。。。
- EntryOptionPlugin应用于compiler
- 触发entryOption hook
- 触发afterPlugins hook
- 为resolveOptions增加一些hook 回调事件
- 触发afterResolvers hook


### compiler.run 方法
- 依次触发各种plugin执行，其中从EntryPlugin开始
- Compilation 构建阶段，主要是通过asyncQueue依次执行 processDependencies - addModuleQueue - factorizeQueue - buildQueue
- build阶段，loader的执行顺序。loader-runner是webpack下另一个lib。LoaderRunner.runLoaders
  - NormalModuleFactory - this.hooks.resolve.tapAsync处理了rules，根据rules的enforce配置对loaders排序。并且特殊处理了（-!, !, !!）去除符号逻辑。
  - 

￼

## 核心流程
![](./webpack.jpg)
### 创建compiler阶段 createCompiler 读取plugin挂载compiler回调事件
### 构建阶段 compiler.run
#### 由EntryPlugin开始
#### compiler.compile阶段 
      准备compilation.dependenciesFactory
#### compiler.make阶段 
      addEntry 添加入口
      递归构建模块树handleModuleCreation 
      - 构建模块
      - 添加模块 addModule 构造compilation的moduleGraph。webpack的模块有向图的处理逻辑在ModuleGraph类的setResolvedModule方法中。
      - 编译模块 buildModule

